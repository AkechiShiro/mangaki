{% extends "base.html" %}

{% block body %}
<div class="row">
    <div class="col-xs-2">
        <img src="{{ user.profile.get_avatar_url }}" alt="Avatar de {{ username }}" id="avatar" />
    </div>
    <div class="col-xs-7">
        <h1>{{ username }}</h1>
	{% if request.user.username == username %}
        <p>
	    Pour personnaliser ton profil, rendez-vous sur
            <a href="http://meta.mangaki.fr/users/{{ user.username }}" target="_blank">MetaMangaki</a>.
        </p>
        {% endif %}
        <p>Inscrit depuis {{ member_days }} jours</p>
        <p>Nombre d'<em>anime</em> vus : {{ anime_count }}</p>
        <p>Nombre de mangas lus : {{ manga_count }}</p>
    </div>
    <div class="col-xs-3">
        {% if request.user.username == username %}
            <br />
            Profil public : <input type="checkbox" name="is_shared" {% if user.profile.is_shared %} checked{% endif %}/>
            <hr />
            <p>Importer depuis myAnimeList :</p>
            <div class="input-group">
                <input type="text" class="form-control" id="mal_username" placeholder="Ton login" onkeydown="if(event.keyCode == 13) {$('#import_mal').click(); this.value = ''};" />
                <span class="input-group-btn">
                    <button id="import_mal" class="btn btn-default">OK</button>
                </span>
            </div>
        {% endif %}
    </div>    
</div>
<div class="row mangas-list{% if request.user.username != username %} another{% endif %}">
    {% if not is_shared %}
        <br />
        <p class="well">Le profil de {{ username }} n'est pas public.</p>
    {% else %}
        <div class="col-xs-4 col-xs-offset-1">
            <h1><a href="/anime">Anime</a> vus</h1>
            {% for object in seen_anime_list %}
                {% include "work_no_poster.html" with work=object.work class="anime" rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
        <div class="col-xs-4 col-xs-offset-1">
            <h1><a href="/anime">Anime</a> à voir (ou non)</h1>
            {% for object in unseen_anime_list %}
                {% include "work_no_poster.html" with work=object.work class="anime" rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
    {% endif %}
</div>
<div class="row mangas-list{% if request.user.username != username %} another{% endif %}">
    {% if is_shared %}
        <div class="col-xs-4 col-xs-offset-1">
            <h1><a href="/manga">Mangas</a> lus</h1>
            {% for object in seen_manga_list %}
                {% include "work_no_poster.html" with work=object.work class="manga" rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
        <div class="col-xs-4 col-xs-offset-1">
            <h1><a href="/manga">Mangas</a> à lire (ou pas)</h1>
            {% for object in unseen_manga_list %}
                {% include "work_no_poster.html" with work=object.work class="manga" rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
    {% endif %}
</div>
<br />
<br />
<br />
<script>
$("[name='is_shared']").bootstrapSwitch();
$("[name='is_shared']").on('switchChange.bootstrapSwitch', function(event, state) {
    $.post('/shared/', {is_shared: state});
});
$("#import_mal").on('click', function() {
    $.post('/mal/' + $('#mal_username').val(), function(data) {
        console.log(data);
        location.reload();
    });
});
</script>
{% endblock %}
