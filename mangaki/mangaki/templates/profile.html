{% extends "base.html" %}

{% block body %}
<div class="row">
    <div class="col-xs-2">
        <img src="{{ avatar_url }}" alt="Avatar de {{ username }}" id="avatar" />
    </div>
    <div class="col-xs-6">
        <h1>{{ username }}</h1>
	{% if request.user.username == username %}
        <p>
	    Pour personnaliser ton profil, connecte-toi sur
            <a href="http://meta.mangaki.fr/session/sso" target="_blank">Meta Mangaki</a>.
        </p>
        {% endif %}
        <p>Inscrit depuis {{ member_days }} jours</p>
    </div>
    <div class="col-xs-4">
        {% if request.user.username == username %}
            <br />
            Profil public : <input type="checkbox" name="is_shared" {% if user.profile.is_shared %} checked{% endif %}/>
            <hr />
            <p>Importer depuis myAnimeList :</p>
            <div class="input-group">
                <input type="text" class="form-control" id="mal_username" placeholder="Ton login" onkeydown="if(event.keyCode == 13) {$('#import_mal').click(); this.value = ''};" />
                <span class="input-group-btn">
                    <button id="import_mal" class="btn btn-default">OK</button>
                </span>
            </div>
        {% endif %}
    </div>    
</div>
<ul class="nav nav-tabs">
    <li role="presentation"{% if category == 'anime' %} class="active"{% endif %}><a href="/u/{{ username }}">Liste d'<em>anime</em> de {{ username }} <span class="badge alert-info">{{ anime_count }}</span></a></li>
    <li role="presentation"{% if category == 'manga' %} class="active"{% endif %}><a href="/u/{{ username }}?category=manga">Liste de mangas de {{ username }} <span class="badge alert-info">{{ manga_count }}</span></a></li>
</ul>
<div class="row mangas-list{% if request.user.username != username %} another{% endif %}">
    {% if not is_shared %}
        <br />
        <p class="well">Le profil de {{ username }} n'est pas public.</p>
    {% else %}
        <div class="col-xs-4 col-xs-offset-1">
<h1>{% if category == 'anime' %}<a href="/anime">Anime</a> favoris{% else %}<a href="/manga">Mangas</a> favoris{% endif %}</h1>
            {% for object in fav_list %}
                {% include "work_no_poster.html" with work=object.work class=category rating="favorite" %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
            <h1>{% if category == 'anime' %}<a href="/anime">Anime</a> vus{% else %}<a href="/manga">Mangas</a> lus{% endif %}</h1>
            {% for object in seen_list %}
                {% include "work_no_poster.html" with work=object.work class=category rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
        <div class="col-xs-4 col-xs-offset-1">
            <h1>{% if category == 'anime' %}<a href="/anime">Anime</a> à voir (ou non){% else %}<a href="/manga">Mangas</a> à lire (ou pas){% endif %}</h1>
            {% for object in unseen_list %}
                {% include "work_no_poster.html" with work=object.work class=category rating=object.choice %}
            {% empty %}
                <p>(Cette liste est vide.)</p>
            {% endfor %}
        </div>
    {% endif %}
</div>
<br />
<br />
<br />
<script>
$("[name='is_shared']").bootstrapSwitch();
$("[name='is_shared']").on('switchChange.bootstrapSwitch', function(event, state) {
    $.post('/shared/', {is_shared: state});
});
$("#import_mal").on('click', function() {
    $.post('/mal/' + $('#mal_username').val(), function(data) {
        console.log(data);
        location.reload();
    });
});
</script>
{% endblock %}
